{% extends "base.html" %}
{% block title %}progscrape{% endblock title %}
{% block head %}
    {{ super() }}
{% endblock head %}
{% block content %}
    <div id="main">
    <div class="container">
    <div class="popular-tags">Trending tags:
        {% for tag in top_tags %}
        <span class="tag"><a href="/?search={{ tag.0 }}">{{ tag.0 }}</a></span>&nbsp;
        {% endfor %}
    </div>

    {# Show the chart for tag/domain searches, but only at offset 0 #}
    {% if (search.type == "tag" or search.type == "domain") and (search.offset == 0) and (stories | length == search.count) %}
    <div id="zeitgeist" data-search="{{ search.text }}">
        <div class="loading">Loading... <span class="spinner"></span></div>
        <canvas></canvas>
        <p class="note">Tag trends are in beta. Feedback? Thoughts? Email me at <a href="mailto:matthew@mastracci.com">matthew@mastracci.com</a></p>
    </div>
    <script id="chartJs" async src="{{ 'chart.js-4.4.3.umd.min.js' | static }}" onload="this.loadState='load'" onerror="this.loadState='error'" ></script>
    <script async src="{{ 'zeitgeist.js' | static }}"></script>
    {% endif %}

    {% for story in stories %}
    <div class="story">
        <h2 class="story-title"><a class="url" href="{{ story.url }}">{{ story.title }}</a></h2>
        <div class="metadata">
            <span class="sites">
                {{ macros_story::comment_links(story=story) }}
            </span>
            <a class="age" title="{{ story.date | absolute_time }} - click for details" href="/s/{{ story.url | trim_start_matches(pat='http://') | trim_start_matches(pat='https://') }}">{{ story.date | relative_time(now=now) }}</a>
            <span class="tags">
                {% for tag in story.tags %}
                <span class="tag"><a href="/?search={{ tag|urlencode }}">{{ tag }}</a></span>
                {% endfor %}
            </span>
        </div>
    </div>
    {% else %}
    <h2 class="error">No stories found!</h2>
    {% endfor %}

    {% if stories | length == search.count %}
    {% if search.text %}
    <p class="more"><a href="?search={{ search.text }}&count={{ search.count }}&offset={{ search.offset + search.count }}">More &rarr;</a></p>
    {% else %}
    <p class="more"><a href="?offset={{ search.offset + search.count }}&count={{ search.count }}">More &rarr;</a></p>
    {% endif %}
    {% endif %}
    </div>
    </div>
{% endblock content %}
